// -----
// Part of the One-Page Checkout plugin, provided under GPL 2.0 license by lat9 (cindy@vinosdefrutastropicales.com).
// Copyright (C) 2013-2018, Vinos de Frutas Tropicales.  All rights reserved.
//
function concatExpiresFields(e){return jQuery(":input[name="+e[0]+"]").val()+jQuery(":input[name="+e[1]+"]").val()}function popupWindow(e){window.open(e,"popupWindow","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=450,height=320,screenX=150,screenY=150,top=150,left=150")}function couponpopupWindow(e){window.open(e,"couponpopupWindow","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=450,height=320,screenX=150,screenY=150,top=150,left=150")}function submitonce(){var e=document.getElementById("btn_submit");return e.style.cursor="wait",e.disabled=!0,setTimeout("button_timeout()",4e3),!1}function button_timeout(){var e=document.getElementById("btn_submit");e.style.cursor="pointer",e.disabled=!1}function zcLog2Console(e){window.console&&"function"==typeof console.log&&console.log(e)}function submitFunction(e,o){var t=arguments.length;submitter=null;for(var n="",i=0;i<t;i++)n+=arguments[i]+", ";if(zcLog2Console("submitFunction, "+t+" arguments: "+n),2==t){var r=document.getElementById("ottotal"),c=r.children[0].textContent.substr(1);if(zcLog2Console("Current order total: "+c+", text: "+r.children[0].textContent),document.getElementById("current-order-total").value=r.children[0].textContent,0==c)zcLog2Console("Order total is 0, setting submitter"),submitter=1;else{for(var u=[].slice.call(document.querySelectorAll("[id^=disc-]")),i=0;i<u.length;i++)""!=u[i].value&&(submitter=1);var s=document.getElementsByName("cot_gv");0!=s.length&&(zcLog2Console("Checking ot_gv value ("+s[0].value+") against order total ("+c+")"),s[0].value>=c&&(submitter=1))}}zcLog2Console("submitFunction, on exit submitter="+submitter)}function methodSelect(e){document.getElementById(e)&&(document.getElementById(e).checked="checked")}function setJavaScriptEnabled(){var e=document.getElementById("javascript-enabled");e&&(e.value="1")}function shippingIsBilling(){var e=document.getElementById("checkoutOneShipto");e&&(document.getElementById("shipping_billing").checked?(e.className="hiddenField",e.setAttribute("className","hiddenField")):(e.className="visibleField",e.setAttribute("className","visibleField")))}function setOrderConfirmed(e){orderConfirmed=e,jQuery("#confirm-the-order").val(e),zcLog2Console("Setting orderConfirmed ("+e+"), submitter ("+submitter+")")}var selected,submitter=null,orderConfirmed=0;jQuery(document).ready(function(){function e(){var e=null;if(document.checkout_payment.payment)if(document.checkout_payment.payment.length)for(var o=0;o<document.checkout_payment.payment.length;o++)document.checkout_payment.payment[o].checked&&(e=document.checkout_payment.payment[o].value);else document.checkout_payment.payment.checked?e=document.checkout_payment.payment.value:document.checkout_payment.payment.value&&(e=document.checkout_payment.payment.value);zcLog2Console("setFormSubmitButton, payment-module: "+e),jQuery("#opc-order-review, #opc-order-confirm").hide(),null==e||-1==confirmation_required.indexOf(e)?(jQuery("#opc-order-confirm").show(),zcLog2Console('Showing "confirm"')):(jQuery("#opc-order-review").show(),zcLog2Console('Showing "review"'))}function o(){var e=jQuery("#checkoutShippingMethod").offset().top;jQuery(window).scrollTop(e)}function t(e){var n=jQuery("input[name=shipping]");if(n.is(":radio")&&(n=jQuery("input[name=shipping]:checked")),0==n.length&&"shipping-billing"!=e)alert(noShippingSelectedError),o();else{var i={shipping:n=n.val(),shipping_is_billing:jQuery("#shipping_billing").is(":checked"),shipping_request:e};0!=additionalShippingInputs.length&&(jQuery.each(additionalShippingInputs,function(e,o){shippingInputs[e]=jQuery('input[name="'+o.input_name+'"]'+o.parms).val()}),i=jQuery.extend(i,shippingInputs)),zcLog2Console("Updating shipping method to "+n+", processing type: "+e),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=updateShipping",data:i,timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutErrorMessage),shippingError=!0}}).done(function(n){jQuery("#orderTotalDivs").html(n.orderTotalHtml);var i=!1;if(jQuery("#otshipping, #otshipping+br").show(),"ok"==n.status?"shipping-billing"==e&&(jQuery("#checkoutShippingChoices").html(n.shippingHtml),jQuery("#checkoutShippingContentChoose").html(n.shippingMessage),jQuery("#checkoutShippingChoices").on("click","input[name=shipping]",function(e){t("shipping-only")})):("timeout"==n.status&&(alert(sessionTimeoutErrorMessage),jQuery(location).attr("href",timeoutUrl)),i=!0,"invalid"==n.status&&(jQuery("#checkoutShippingMethod input[name=shipping]").prop("checked",!1),jQuery("#checkoutShippingChoices").html(n.shippingHtml),jQuery("#checkoutShippingChoices").on("click","input[name=shipping]",function(e){t("shipping-only")}),jQuery("#otshipping, #otshipping+br").hide(),o()),""!=n.errorMessage&&("submit"!=e&&"shipping-billing"!=e&&"submit-cc"!=e||alert(n.errorMessage))),zcLog2Console("Shipping method updated, error: "+i),"submit"==e||"submit-cc"==e)if(1==i)zcLog2Console("Shipping error, correct to proceed.");else if(zcLog2Console("Form submitted, type ("+e+"), orderConfirmed ("+orderConfirmed+")"),"submit-cc"==e)jQuery('form[name="checkout_payment"]').submit();else if(orderConfirmed&&(jQuery("#confirm-order").attr("disabled",!0),flagOnSubmit)){var r=check_form();zcLog2Console("Form checked, passed ("+r+")"),r&&(jQuery("#confirm-order").attr("disabled",!1),jQuery('form[name="checkout_payment"]').submit())}})}}var n=!1;0==jQuery('form[name="checkout_payment"]').length&&(n=!0,zcLog2Console('Missing form[name="checkout_payment"]')),0==jQuery("#orderTotalDivs").length&&(n=!0,zcLog2Console("Missing #orderTotalDivs")),0==jQuery("#current-order-total").length&&(n=!0,zcLog2Console("Missing #current-order-total")),0==jQuery("#opc-order-confirm").length&&(n=!0,zcLog2Console("Missing #opc-order-confirm")),0==jQuery("#opc-order-review").length&&(n=!0,zcLog2Console("Missing #opc-order-review")),virtual_order||0==jQuery("#otshipping").length&&(n=!0,zcLog2Console("Missing #otshipping")),n&&alert("Please contact the store owner; some required elements of this page are missing."),shippingIsBilling(),setJavaScriptEnabled(),jQuery(document).on("keypress",":input:not(textarea)",function(e){return 13!=e.keyCode}),e(),setOrderConfirmed(0),jQuery("#checkoutOneShippingFlag").show(),zcLog2Console("jQuery version: "+jQuery().jquery),collectsCardDataOnsite=function(e){return zcLog2Console("Checking collectsDardDataOnsite("+e+") ..."),zcJS.ajax({url:"ajax.php?act=ajaxPayment&method=doesCollectsCardDataOnsite",data:{paymentValue:e}}).done(function(o){if(1==o.data){zcLog2Console(" ... it does!");var t=jQuery('form[name="checkout_payment"]').serializeArray();zcJS.ajax({url:"ajax.php?act=ajaxPayment&method=prepareConfirmation",data:t}).done(function(o){jQuery("#checkoutPayment").hide(),jQuery("#navBreadCrumb").html(o.breadCrumbHtml),jQuery("#checkoutPayment").before(o.confirmationHtml),jQuery(document).attr("title",o.pageTitle),jQuery(document).scrollTop(0),-1==confirmation_required.indexOf(e)?(zcLog2Console('Preparing to submit form, since confirmation is not required for "'+e+'", per the required list: "'+confirmation_required),jQuery("#checkoutOneLoading").show(),jQuery('form[name="checkout_confirmation"]')[0].submit()):(zcLog2Console("Confirmation required, displaying for "+e+"."),jQuery("#checkoutConfirmDefault").show())})}else zcLog2Console(" ... it does not, submitting."),jQuery('form[name="checkout_payment"]')[0].submit()}),!1};var i=null;doesCollectsCardDataOnsite=function(e){return zcLog2Console("Checking doesCollectsCardDataOnsite("+e+") ..."),jQuery("#"+e+"_collects_onsite").val()&&jQuery("#pmt-"+e).is(":checked")?(zcLog2Console("... it does!"),i=e,!0):(zcLog2Console("... it does not."),i=null,!1)},doCollectsCardDataOnsite=function(){var e=jQuery('form[name="checkout_payment"]').serializeArray();zcLog2Console("doCollectsCardDataOnsite for "+i),zcJS.ajax({url:"ajax.php?act=ajaxPayment&method=prepareConfirmation",data:e}).done(function(e){jQuery("#checkoutPayment").hide(),jQuery("#navBreadCrumb").html(e.breadCrumbHtml),jQuery("#checkoutPayment").before(e.confirmationHtml),jQuery(document).attr("title",e.pageTitle),jQuery(document).scrollTop(0),-1==confirmation_required.indexOf(i)?(zcLog2Console('Preparing to submit form, since confirmation is not required for "'+i+'", per the required list: "'+confirmation_required),jQuery("#checkoutOneLoading").show(),jQuery("#checkoutConfirmationDefault").hide(),jQuery('form[name="checkout_confirmation"]')[0].submit()):(zcLog2Console("Confirmation required, displaying for "+i+"."),jQuery("#checkoutConfirmDefault").show())})},jQuery("#checkoutShippingMethod input[name=shipping]").on("click",function(e){t("shipping-only",e)}),jQuery("#shipping_billing").on("click",function(e){shippingIsBilling(),t("shipping-billing")}),jQuery(".opc-cc-submit").on("click",function(e){zcLog2Console("Submitting credit-class request"),setOrderConfirmed(0),t("submit-cc")}),jQuery("input[name=payment]").on("change",function(){e()}),jQuery("#opc-order-review, #opc-order-confirm").on("click",function(e){submitFunction(0,0),setOrderConfirmed(1),zcLog2Console("Submitting order-creating form"),t("submit")}),jQuery("#checkoutPaymentNoJs").hide(),jQuery("#checkoutPayment").show()});